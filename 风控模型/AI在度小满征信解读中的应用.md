## AI在度小满征信解读中的应用

- 分享嘉宾：正兴 度小满金融 算法高级专家
- **导读：**本文的主题是AI技术在征信解读中的应用，主要介绍我们针对金融征信数据以及面向信贷领域模型在技术上的优化实践。
- 2021-10-22

### 1. 征信数据介绍

<img src="AI%E5%9C%A8%E5%BA%A6%E5%B0%8F%E6%BB%A1%E5%BE%81%E4%BF%A1%E8%A7%A3%E8%AF%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.assets/640.webp" alt="图片" style="zoom:50%;" />

- 征信数据的主要内容包含了6个方面，其中最主要的是4大块，包括**个人基本信息，信贷交易明细，非信贷信用信息**，以及**查询记录**。
- **个人基本信息**主要是来源于公安部个人信息、共享平台，**各类金融机构自己的信息**，比如说，某个人的学历学位、已婚未婚、户籍地、居住地址以及工作地的历史列表；
- **信贷交易明细**主要是贷款、贷记卡的一些历史的信息和当前的信息。这里的*贷记卡主要是指信用卡*。另外还有准贷记卡明细的信息。**贷款信息主要包含个人的贷款时间、额度、期数、类型、贷款机构和机构类型、当前的每月应还多少，已还多少等等单月信息以及历史逾期情况**；
- **非信贷信用信息**主要包括**公积金**的缴纳信息，这个信息是*官方*的，包括缴纳的金额、比例、公司等；
- **查询记录**主要是贷款或申请贷记卡的时候允许查询征信信用报告，个人信用报告，能够反映个人的户头借贷的信息。
- 基本上看，征信报告记录了**强金融相关的数据**，并且和官方是一致的。 

### 2. 信贷模型场景介绍

<img src="AI%E5%9C%A8%E5%BA%A6%E5%B0%8F%E6%BB%A1%E5%BE%81%E4%BF%A1%E8%A7%A3%E8%AF%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.assets/640-16445481440005.webp" alt="图片" style="zoom:50%;" />

- 在数据上，通常征信数据一大块，自有数据一大块，相对于产品数据的话，征信数据可能更强一些，因为征信数据是直接金融相关的。
- 在利用征信数据方面，历史上和现如今各机构传统上主要使用的是**评分卡模型**。该模型一般是基于专家经验来加工几个或者几十个特征之后，最后处理成一个**加和模型**。这种模型具有一个非常好的可解释性，以及对样本规模较低的依赖，效果相对于复杂模型会差一些。
- 复杂模型有两个基本的思路，一个思路是去加工提取更多的特征，进一步用更复杂的模型；另外一个思路是基于原始数据，做**非结构化特征**来构建端到端的模型，端到端模型也会使用复杂特征。
- 今天主要分享**端到端的模型**。一般来讲，端到端模型是三种建模方式里面效果最好的。因为它能**充分利用不太好加工的数据，比如说文本类的数据**。

### 3. 模型

- <img src="AI%E5%9C%A8%E5%BA%A6%E5%B0%8F%E6%BB%A1%E5%BE%81%E4%BF%A1%E8%A7%A3%E8%AF%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.assets/640-164454828450610.webp" alt="图片" style="zoom:50%;" />

#### 3.1 模型结构优化

- 基于征信报告的端到端的建模主要**面临以下几个问题**：

  - 第一个是数据是半结构化的。不同于比较规整的数据，比如说贷款和贷记卡粒度的数据，里面会有一些文本信息，这部分数据也是半结构化的，和纯粹的自然语言还不太一样；征信报告中的**文本是相对稀疏和弱相关的**。
  - 第二个问题是在征信数据里面，一些比较强的风险特征会在前置规则里面应用，一旦触发就会直接过滤掉相关数据，并不会进入到我们的系统里面。比如征信中历史逾期现象比较严重的，他已经逾期了，根本就不会进入到我们的系统中。因此，模型要从弱一点的信息中以及不同的信息交叉里面来学习风险排序。

- 提出一个技术模型方案Model1。

  - <img src="AI%E5%9C%A8%E5%BA%A6%E5%B0%8F%E6%BB%A1%E5%BE%81%E4%BF%A1%E8%A7%A3%E8%AF%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.assets/640-164454854053217.webp" alt="图片" style="zoom:50%;" />
  - 由于基本信息都有数值和类别的特征，因此我们会在底层做基本信息整合。在此之上，大量使用类似self-attention的结构，左联两个交叉之后的信息汇聚，比如**贷款内部**的**序列信息交叉**，**贷记卡内部的序列信息交叉**,以及它们之间的交叉；
  - 对于文本信息同样也使用两层的multi head attention结构，因为它是两层序列关系，一个是文本序列本身，然后是序列之间。
  - 我们也尝试使**用更深的transformer模型，实验中发现效果不好**，不如浅一点的模型，我们推测是由于**文本比较稀疏**，以及在相对比较强的场景下，征信信息，可能是在一定程度上，对组合记忆能力强的模型会优于在更高维度上泛化的模型。

- Model2

  - <img src="AI%E5%9C%A8%E5%BA%A6%E5%B0%8F%E6%BB%A1%E5%BE%81%E4%BF%A1%E8%A7%A3%E8%AF%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.assets/640-164454886210520.webp" alt="图片" style="zoom:50%;" />

  - 针对前面的基础模型，虽然我们做了**4路维度的交叉和信息整合**，在效果上已经大幅度超过了之前的xgb复杂模型，但是我们认为对**趋势信息**的捕捉还是不充分的。
  - 在用户的贷款数据上看，**贷款的行为具有时间聚集性**的，在某段时间会比较集中，在某段时间会又比较空窗，同时**贷款、查询、贷记卡申请这三者之间是内部高度相关**的。比如贷款、贷记卡，在申请贷款或者贷记卡发卡的时候，会有贷款的查询，在查询之后，会产生贷款或贷记卡。有的可能没有借，可能没有通过。
  - 基于这个理解，我们对模型的结构上进一步优化，对贷款、贷记卡各自编码后，组成一个整体的序列，前面是分开的编码，内部做交叉；做成一个完整的序列后，我们做一个内部的组合，Session之间做一个序列模型，对趋势信息做一个建模。
  - ==问题：== 
    - 并没有说内部怎么整合的
    - 换句话说原先的model1统一时间粒度所有变量没有统一建模？序列模型本质上只充当了一个时序特征聚合的功能(这不是一个正常使用序列模型，尤其是MHA的方式)
    - 时间片段切分粒度如何确定，固定长度可能正好切在一个集中申请段中间？
    - 如果按照图中只是MHA，本质上没有特别对channel进行特征交叉

- Model3

  - <img src="AI%E5%9C%A8%E5%BA%A6%E5%B0%8F%E6%BB%A1%E5%BE%81%E4%BF%A1%E8%A7%A3%E8%AF%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.assets/640-164454955111023.webp" alt="图片" style="zoom:50%;" />
  - 进一步的，在时间维度下，征信报告上有两个维度，一个是前面介绍过的贷款发生时间，以及贷记卡发卡时间；另一个是**还款时间，是一个嵌套子序列**。举例，对每笔贷款，在5年的历史内，每个月的还款状态，这个时间序列和贷款时间是两个维度，还款序列直接放在贷款维度下面其实不利于学习整体还款趋势变化的。基于这一点进行了优化，把**贷款的还款序列和基本信息做交叉**。之所以这样做是因为贷款这个序列本身是不充分的，它只能体现这个月有没有发生逾期，逾期多少钱，**但是贷款是什么类型的贷款以及期数是多少，这些信息也都很重要**。我们的一个基本优化策略就是把它们两个做一个结合之后，放在一个序列之上，从而对前面的模型做一个增强。

- Model4

  - ![图片](AI%E5%9C%A8%E5%BA%A6%E5%B0%8F%E6%BB%A1%E5%BE%81%E4%BF%A1%E8%A7%A3%E8%AF%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.assets/640-164455001256526-164455001405628.webp)
  - 对于征信数据中的文本信息的利用上我们也做了很多优化的工作。基本的思路是建立**关联网络**，使用**图神经网络**进行挖掘。
  - 原因是征信文本信息和常见的自然语言的分布不完全一致，征信文本里面的信息主要是地址信息、公司信息等，包含大量的偏长尾的专名，比如某个地理位置，公司名。这个公司名具有一定的含义，如果没有额外的知识的话，很难理解它的信息。前面的几种直接对文本的建模只能识别浅层的相关性，这个可能也是使用传统的transformer模型在这里不工作的原因。
  - 对于这部分信息，我们的优化思路是把这些**作为一个节点**，**构建关联网络侦测背后隐藏的信息**。这里举一个例子，比如有个公司名，叫华工正源光子技术，如果直接建模可能会学到里面的一些含义信息，比如说光子技术。但**对于前面的专名华工正源，很难积累到足够的样本**去学习它的风险，但是通**过关联网络，关联它和其他用户、以及真实世界的其他信息，综合去汇集华工正源的风险信号**，**进一步去推断这个用户的风险**。整个模型可以是一个**端到端**的方式进行训练，找到一个可以优化的整体的特征组和参数，以上是我们对于文本的优化的一个工作。

#### 3.2 预训练模型的优化

- <img src="AI%E5%9C%A8%E5%BA%A6%E5%B0%8F%E6%BB%A1%E5%BE%81%E4%BF%A1%E8%A7%A3%E8%AF%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.assets/640-164455887405129.webp" alt="图片" style="zoom:50%;" />- 

- 因此，我们做的优化是，对整体相关的信息做离散化整体组合编码，变成整体空间里的一个点，比如把贷款，整体映射到贷款空间里的某个点，对整体进行预测；
- 同时也要对预测做优化，因为组合起来的数非常多。我们采用**类似hierarchal softmax这种层次化优化，根据它的相关性做聚类，做两级的预测**，实际上，我们做了优化后，对比不做预训练的模型，新的模型大幅超过之前的模型，效果有明显提升。

#### 3.4 风险排序模型的应用

<img src="AI%E5%9C%A8%E5%BA%A6%E5%B0%8F%E6%BB%A1%E5%BE%81%E4%BF%A1%E8%A7%A3%E8%AF%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.assets/640-164455903858432.webp" alt="图片" style="zoom:50%;" />

- **comment:** 思路和应用例子挺好，但解释比较牵强
- **???** : 通常，对于分类模型，最终会输出一个类似概率的分布。对于风险因子模型，==最终要的并不是最大化预估准确的条件概率，而是要区分用户风险的排序，因为具体到每个用户上，他逾期不逾期是离散的==。我们用的auc或KS来衡量效果本身对应是一种排序的能力。(????)
- 但把优化目标转成排序模型后，可以有**引入更多的信息，来定义排序的优化目标**，使得模型更符合我们的需要。**比如说，我们可以定义坏人，也就是逾期的人， 的排序，把逾期时间早的人放在前面，认为他是一个更坏的人，也可能有其他协议的，逾期比较往后的这些人排到后面一点，他可能是有一定的偶然因素。**
- 类似这种方式，我们实践下来会有这样一个结果，我们在长期逾期区分能力差不多的情况下，可能会明显提升短期逾期风险人的区分能力。
- 因为一般来讲，早期逾期的人会少一点，把他们排到后面逾期的人的前面，在分类面上会累积后面逾期特征上的组合。比如说疫情影响的处理，我们可以结合蒸馏学习的思路。**对疫情影响的逾期，我们可以人工定义某个好坏的程度，比如可以利用一个非疫情影响的样本，训练一个大模型的排序，作为子模型排序的一个优化目标。**通过蒸馏排序，整个优化目标是无偏的，整体上一致的。这样做不像其他的方式，比如在损失函数上定义权重会引入超参，但我们不知道如何定义这个权重等问题，就会打破原有的样本分布。而我们的方式可能还是在整体的一个框架下做这个事情，这样处理会比较平滑。

### 4. 复杂模型的可解释性

- <img src="AI%E5%9C%A8%E5%BA%A6%E5%B0%8F%E6%BB%A1%E5%BE%81%E4%BF%A1%E8%A7%A3%E8%AF%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.assets/640-164455949774935.webp" alt="图片" style="zoom:50%;" />
- 一个是IG方法，就是Integrated gradients，另一个是SHAP类方法。IG是基于梯度的，SHAP是一类方法，它可以在不同场景下实现这种方式。
- 实际应用中，模型debug的时候去算影响，但是在业务上会使用一个代理模型，对一些高级特征去做计算。

### 5 QA

Q：征信报告中的文本都是居住地，工作单位之类的，这类数据怎么更好的编码？

A：今天我分享的主要是端到端的模型，这种模型是直接编码的，把字或者词直接变成embedding，再映射到低维连续空间里，再做进一步的组合。

Q：征信表现N123C这种信息，神经网络采用哪种编码模型？

A：这些可以理解为一种类别元素，1表示逾期1个月，2 表示逾期两个月，但是里面可以做一个分段，大于10做一个分段，因为比较稀疏。其实在一个信息厚度情况下，可以将离散的编码做embedding。

Q：一份征信报告中是一个样本，还是一个征信报告按时间拆成多个样本？

A：我们是**对用户**来做风险判断，因此一个征信报告是一个样本。

Q：征信报告有的是数据是状态数据有的是行为数据，怎么构建神经网络结构？

A：行为数据指的是什么？行为也可以理解历史的行为，也是状态数据，因此处理方式类似。